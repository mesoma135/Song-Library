<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Songify - Views</title>
    <link rel="stylesheet" href="Style.css">
    <style>
        body { background-color: #121212; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

        .navbar {
            display: flex;
            align-items: center;
            padding: 15px 30px;
            background-color: #1f1f1f;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .navbar .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ff1db9;
        }

        .nav-links {
            margin-left: auto; /* push links to right */
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #ff1db9;
            font-weight: bold;
        }

        .auth-buttons {
            margin-left: 20px;
        }

        .horizontal-scroll {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding-bottom: 10px;
            justify-content: center;
        }

        .song-card, .playlist-card, .song-large {
            background-color: #1f1f1f;
            border-radius: 15px;
            padding: 15px;
            flex: 0 0 200px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .song-card:hover, .playlist-card:hover, .song-large:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .song-info h4, .playlist-info h4 {
            margin-bottom: 10px;
        }

        .small-muted {
            color: #aaa;
            font-size: 14px;
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .card-body h3 {
            font-size: 18px;
            text-align: center;
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #aaa;
        }

        .listens-badge {
            background-color: #ff1db9;
            color: #fff;
            padding: 2px 6px;
            border-radius: 5px;
            font-size: 12px;
        }

        .logo a {
            text-decoration: none;
            color: #ff1db9;
        }

        .featured p{
            padding-bottom: 15px;
        }

        .featured {
            padding: 40px 20px;
            text-align: center;
        }

        .featured h2 {
            font-size: 36px;
            margin-bottom: 15px;
        }

        .featured .section-subtitle {
            font-size: 16px;
            color: #aaa;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<header class="navbar">
    <div class="logo"><a href="index.html">Songify</a></div>
    <nav class="nav-links">
        <a href='Index.html'>Home</a>
        <a href='Songs.html'>Songs</a>
        <a href='Artists.html'>Artists</a>
        <a href='Playlists.html'>Playlists</a>
        <a href="musicNews.html">News</a>
        <a href='views.html' class="active">Views</a>

    </nav>
    <div class="auth-buttons" id="authButtons">
        <!-- Will be populated by JS below-->
    </div>
</header>

<main>
    <section class="featured">
        <h2>Recent Songs</h2>
        <p class="section-subtitle">Latest releases</p>
        <div class="horizontal-scroll">
            <div class="song-card">
                <div class="song-info">
                    <h4>New Track A</h4>
                    <span class="small-muted">Artist One</span>
                </div>
            </div>
            <div class="song-card">
                <div class="song-info">
                    <h4>New Track B</h4>
                    <span class="small-muted">Artist Two</span>
                </div>
            </div>
            <div class="song-card">
                <div class="song-info">
                    <h4>New Track C</h4>
                    <span class="small-muted">Artist Three</span>
                </div>
            </div>
        </div>
    </section>

    <section class="featured">
        <h2>Recent Playlist Adds</h2>
        <p class="section-subtitle">Playlists recently created</p>
        <div class="horizontal-scroll">
            <div class="playlist-card">
                <div class="playlist-info">
                    <h4>0</h4>
                    <span class="small-muted">Added by X</span>
                </div>
            </div>
            <div class="playlist-card">
                <div class="playlist-info">
                    <h4>1</h4>
                    <span class="small-muted">Added by X</span>
                </div>
            </div>
            <div class="playlist-card">
                <div class="playlist-info">
                    <h4>2</h4>
                    <span class="small-muted">Added by X</span>
                </div>
            </div>
        </div>
    </section>

    <section class="featured">
        <h2>Most Played Songs</h2>
        <p class="section-subtitle">Tracks with the highest play counts</p>
        <div class="card-container most-played">
            <div class="card song-large">
                <div class="card-body">
                    <h3>Hit Single A</h3>
                    <div class="meta-row">
                        <span class="small-muted">Artist One</span>
                        <span class="listens-badge">listens</span>
                    </div>
                </div>
            </div>
            <div class="card song-large">
                <div class="card-body">
                    <h3>Hit Single B</h3>
                    <div class="meta-row">
                        <span class="small-muted">Artist Two</span>
                        <span class="listens-badge">listens</span>
                    </div>
                </div>
            </div>
            <div class="card song-large">
                <div class="card-body">
                    <h3>Hit Single C</h3>
                    <div class="meta-row">
                        <span class="small-muted">Artist Three</span>
                        <span class="listens-badge">listens</span>
                    </div>
                </div>
            </div>
            <div class="card song-large">
                <div class="card-body">
                    <h3>Hit Single D</h3>
                    <div class="meta-row">
                        <span class="small-muted">Artist Four</span>
                        <span class="listens-badge">listens</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="featured">
        <h2>Total Plays by Artist</h2>
        <p class="section-subtitle">Sum of all plays per artist</p>
        <div style="width: 90%; max-width: 900px; margin: 0 auto;">
            <canvas id="totalPlaysByArtistChart"></canvas>
        </div>
    </section>
</main>

<footer>
    <div class="footer-content">
        <div class="footer-left">
            <h3>Songify</h3>
            <p>Explore your favourite artists and their music, make playlists with the best songs. Your next hit is just a click away.</p>
        </div>
        <div class="footer-right">
            <h4>Quick Links</h4>
            <ul>
                <li><a href='Index.html'>Home</a></li>
                <li><a href='Songs.html'>Songs</a></li>
                <li><a href='Artists.html'>Artists</a></li>
                <li><a href='Playlists.html'>Playlists</a></li>
            </ul>
        </div>
    </div>
    <div class="footer-bottom">
        &copy; 2025 Songify. All rights reserved.
    </div>
</footer>
<script>
    async function loadRecentPlaylists() {
        try {
            const res = await fetch('http://localhost:3000/api/playlist/recent');
            const playlists = await res.json();


            const container = document.querySelector('section.featured:nth-of-type(2) .horizontal-scroll');
            container.innerHTML = ''; // clear placeholders

            playlists.forEach(pl => {
                const div = document.createElement('div');
                div.classList.add('playlist-card');

                div.innerHTML = `
                <div class="playlist-info">
                    <h4>${pl.PlaylistName}</h4>
                    <span class="small-muted">Added by ${pl.CreatorName}</span>
                </div>
            `;
                container.appendChild(div);
            });
        } catch (err) {
            console.error(err);
        }
    }



    async function loadRecentSongs() {
        try {
            const res = await fetch('http://localhost:3000/api/song/recent');
            const songs = await res.json();

            const container = document.querySelector('section.featured:nth-of-type(1) .horizontal-scroll');
            container.innerHTML = ''; // clear placeholders

            songs.forEach(song => {
                const div = document.createElement('div');
                div.classList.add('song-card');

                div.innerHTML = `
                        <div class="song-info">
                            <h4>${song.Title}</h4>
                            <span class="small-muted">${song.ArtistName}</span>
                        </div>
                    `;
                container.appendChild(div);
            });
        } catch (err) {
            console.error(err);
        }
    }

    async function loadMostPlayed() {
        try {
            const res = await fetch('http://localhost:3000/api/song/allWithArtist');
            const songs = await res.json();

            const sorted = songs.sort((a, b) => b.NumPlays - a.NumPlays).slice(0, 5);

            const container = document.querySelector('section.featured:nth-of-type(3) .card-container');
            container.innerHTML = '';

            sorted.forEach(song => {
                const div = document.createElement('div');
                div.classList.add('card', 'song-large');

                div.innerHTML = `
                <div class="card-body">
                    <h3>${song.Title}</h3>
                    <div class="meta-row">
                        <span class="small-muted">${song.ArtistName}</span>
                        <span class="listens-badge">${song.NumPlays} listens</span>
                    </div>
                </div>
            `;
                container.appendChild(div);
            });
        } catch (err) {
            console.error(err);
        }
    }

    // Load all sections after DOM
    window.addEventListener('DOMContentLoaded', () => {
        loadRecentSongs();
        loadRecentPlaylists();
        loadMostPlayed();
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    async function loadTotalPlaysByArtistChart() {
        try {
            const res = await fetch('http://localhost:3000/api/song/allWithArtist');
            const songs = await res.json();

            // Aggregate total plays per artist
            const artistPlaysMap = {};
            songs.forEach(song => {
                const artist = song.ArtistName;
                if (!artistPlaysMap[artist]) artistPlaysMap[artist] = 0;
                artistPlaysMap[artist] += song.NumPlays;
            });

            // Convert to arrays for Chart.js
            const labels = Object.keys(artistPlaysMap);
            const data = Object.values(artistPlaysMap);

            const sortedIndices = data.map((v, i) => i)
                .sort((a, b) => data[b] - data[a])
                .slice(0, 10);

            const topLabels = sortedIndices.map(i => labels[i]);
            const topData = sortedIndices.map(i => data[i]);

            const ctx = document.getElementById('totalPlaysByArtistChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topLabels,
                    datasets: [{
                        label: 'Total Plays',
                        data: topData,
                        backgroundColor: 'rgba(255,29,185,0.7)',
                        borderColor: 'rgba(255,29,185,1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#fff' }
                        },
                        x: {
                            ticks: { color: '#fff' }
                        }
                    }
                }
            });
        } catch (err) {
            console.error("Failed to load chart data:", err);
        }
    }

    window.addEventListener('DOMContentLoaded', () => {
        loadTotalPlaysByArtistChart();
    });
</script>

</body>


</html>
